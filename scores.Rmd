---
title: "Preliminary OHI scores"
output:
  html_document:
    toc: true
    toc_float: true
#    keep_md: true
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
source("./_site.R")

## redo flower plots? (they are created in master branch)
redo_flowers = FALSE
```

Ocean Health Index scores are calculated for each region for each goal before being combined into an overall Index score for Hawaii. The four regions are Hawaii, Maui Nui, Oahu, and Kauai & Niihau. <!---could bring back the Regions page to be only linked from here---> 

Flower plots display preliminary scores, with each petal representing an individual goal. Petal lengths convey the score of the goal, thus longer petals are closer to achieving their target. Only goals that are relevant to a region are scored, otherwise they are set to NA with grey petals. All scores are on a scale from 0-100, and the center number is the region's Index score.

----

```{r plot_flower Casey, results='asis'}

## Source from ohibc until added to ohicore, see https://github.com/OHI-Science/ohibc/blob/master/regionHoweSound/ohibc_howesound_2016.Rmd
source('https://raw.githubusercontent.com/OHI-Science/ohibc/master/src/R/common.R')
source('https://raw.githubusercontent.com/OHI-Science/ohibc/master/regionHoweSound/plot_flower.R')

## goal_names
goal_names <- read_csv('goal_names.csv')
regions <- bind_rows(
  data_frame(                # order regions to start with whole study_area
    region_id   = 0,
    region_name = study_area),
  read_csv(file.path(dir_scenario, 'spatial/regions_list.csv')) %>%
    select(region_id = rgn_id, 
           region_name = rgn_name)) %>%
  mutate(
    flower_png = sprintf('images/flower_%s.png', str_replace_all(region_name, ' ', '_')))

## cycle through each region
for (i in regions$region_id) { #i = 0
  
  # don't create new pngs if they exist and if flower png exists and not redoing here
  if (file.exists(regions$flower_png) & !redo_flowers) next
  
  ## set up for plotting
  score_df <- scores %>%
    filter(dimension == 'score') %>%
    filter(region_id == i) %>%
    select(-region_id) %>%
    distinct() %>%
    inner_join(weight, by = 'goal')
  
  goal_labels <- score_df %>%
    left_join(goal_names, by = 'goal') %>%
    mutate(goal_label = str_replace(goal_label, ' ', '\n'),
           goal_label = paste(goal_label, round(score), sep = '\n')) %>%
    select(goal, goal_label)
  

  ## Casey's new flower plot
  plot_obj <- plot_flower(score_df,
                          goal_labels = goal_labels, 
                          incl_legend = TRUE) 

  
  ## make interactive with plotly
  ### NOTE:: currently plotly doesn't work with polar coordinates. https://github.com/ropensci/plotly/issues/878
  ### NOTE:: When this feature is available, redo display below. 
  # library(plotly) # devtools::install_github("ropensci/plotly")
  # p <- ggplotly(plot_obj)
  
}


## display ----

# header, flower
cat(sprintf('## %s\n\n![](%s)\n\n\n\n', regions$region_name, regions$flower_png), sep = "")

```


[<img src="https://docs.google.com/drawings/d/1633uvIYgsBhiKBddQAaTlvYDJgOK1uiDB6wkooNyhFc/pub?w=576&h=288" width="100px">](http://ohi-science.org)  
[ohi-science.org home](http://ohi-science.org)
